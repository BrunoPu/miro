-- Declaração da tabela temporária @responsavel para armazenar os resultados
DECLARE @responsavel TABLE (
    idcertificado INT,  -- Identificador do certificado
    AnalistaFuncional VARCHAR(MAX),  -- Funcional do analista
    AnalistaNome VARCHAR(300),  -- Nome do analista
    dtcadastro DATE  -- Data de cadastro
)

-- Inserção dos dados na tabela @responsavel
INSERT INTO @responsavel (idcertificado, AnalistaFuncional, AnalistaNome)
-- Seleção dos dados distintos da tabela TBCertificados AWSAPI com aplicação de função de split
SELECT DISTINCT
    C.id,  -- Identificador do certificado
    TRIM(split.value) AS Funcional,  -- Valor da função após o split
    NULL AS Nome  -- Define NULL para o nome já que estamos selecionando apenas as funcionais
-- Tabela principal
FROM
    TBCertificados AWSAPI C (NOLOCK)
-- Aplicação da função de split para separar os valores do campo analista_funcional
CROSS APPLY
    STRING_SPLIT(C.analista_funcional, ',') AS split
-- Condição para selecionar apenas os valores que contêm números (funcionais)
WHERE
    ISNUMERIC(TRIM(split.value)) = 1
Espero que isso ajude a entender melhor cada parte do código!





Message ChatGPT…

